(()=>{"use strict";class e{constructor(e={en:"a",ru:"а"},t="base-width",n="en",s={en:"A",ru:"А"},i="KeyA"){this.node=null,this.text=e,this.width=t,this.lang=n,this.altText=s,this.code=i}init(){switch(this.node=document.createElement("button"),this.node.classList.add("keyboard__key"),this.node.dataset.button=this.text.en,this.width){case"base-width":this.node.classList.add("keyboard__key_base-width");break;case"mid-width":this.node.classList.add("keyboard__key_mid-width");break;case"large-width":this.node.classList.add("keyboard__key_large-width");break;case"space-width":this.node.classList.add("keyboard__key_space-width")}this.changeText()}changeText(){this.node.innerHTML=this.text[this.lang]}changeLanguage(e){this.lang=e,this.changeText()}shift(){this.node.classList.remove("shift")}caps(){this.node.classList.remove("shift")}}class t extends e{constructor(e={en:"a",ru:"а"},t="base-width",n="en",s={en:"A",ru:"А"},i="KeyA"){super(e,t,n,s,i)}shift(){[this.text,this.altText]=[this.altText,this.text],this.changeText(),this.node.classList.toggle("shift")}caps(){this.node.classList.toggle("shift")}}class n extends e{constructor(e={en:"a",ru:"а"},t="base-width",n="en",s={en:"A",ru:"А"},i="KeyA"){super(e,t,n,s,i)}shift(){this.node.classList.toggle("shift")}caps(){this.node.classList.toggle("shift")}}const s="base-width",i="mid-width",a="large-width",r="alternative",d="functional",o="letter",c=[{text:{en:"`",ru:"ё"},altText:{en:"~",ru:"ё"},width:s,type:r,code:"Backquote",end:!1},{text:{en:"1",ru:"1"},altText:{en:"!",ru:"!"},width:s,type:r,code:"Digit1",end:!1},{text:{en:"2",ru:"2"},altText:{en:"@",ru:'"'},width:s,type:r,code:"Digit2",end:!1},{text:{en:"3",ru:"3"},altText:{en:"#",ru:"№"},width:s,type:r,code:"Digit3",end:!1},{text:{en:"4",ru:"4"},altText:{en:"$",ru:";"},width:s,type:r,code:"Digit4",end:!1},{text:{en:"5",ru:"5"},altText:{en:"%",ru:"%"},width:s,type:r,code:"Digit5",end:!1},{text:{en:"6",ru:"6"},altText:{en:"^",ru:":"},width:s,type:r,code:"Digit6",end:!1},{text:{en:"7",ru:"7"},altText:{en:"&",ru:"?"},width:s,type:r,code:"Digit7",end:!1},{text:{en:"8",ru:"8"},altText:{en:"*",ru:"*"},width:s,type:r,code:"Digit8",end:!1},{text:{en:"9",ru:"9"},altText:{en:"(",ru:"("},width:s,type:r,code:"Digit9",end:!1},{text:{en:"0",ru:"0"},altText:{en:")",ru:")"},width:s,type:r,code:"Digit0",end:!1},{text:{en:"-",ru:"-"},altText:{en:"_",ru:"_"},width:s,type:r,code:"Minus",end:!1},{text:{en:"=",ru:"="},altText:{en:"+",ru:"+"},width:s,type:r,code:"Equal",end:!1},{text:{en:"Backspace",ru:"Backspace"},altText:{en:"Backspace",ru:"Backspace"},width:a,type:d,code:"Backspace",end:!0},{text:{en:"Tab",ru:"Tab"},altText:{en:"Tab",ru:"Tab"},width:i,type:d,code:"Tab",end:!1},{text:{en:"q",ru:"й"},altText:{en:"q",ru:"й"},width:s,type:o,code:"KeyQ",end:!1},{text:{en:"w",ru:"ц"},altText:{en:"w",ru:"ц"},width:s,type:o,code:"KeyW",end:!1},{text:{en:"e",ru:"у"},altText:{en:"e",ru:"у"},width:s,type:o,code:"KeyE",end:!1},{text:{en:"r",ru:"к"},altText:{en:"r",ru:"к"},width:s,type:o,code:"KeyR",end:!1},{text:{en:"t",ru:"е"},altText:{en:"t",ru:"е"},width:s,type:o,code:"KeyT",end:!1},{text:{en:"y",ru:"н"},altText:{en:"y",ru:"н"},width:s,type:o,code:"KeyY",end:!1},{text:{en:"u",ru:"г"},altText:{en:"u",ru:"г"},width:s,type:o,code:"KeyU",end:!1},{text:{en:"i",ru:"ш"},altText:{en:"i",ru:"ш"},width:s,type:o,code:"KeyI",end:!1},{text:{en:"o",ru:"щ"},altText:{en:"o",ru:"щ"},width:s,type:o,code:"KeyO",end:!1},{text:{en:"p",ru:"з"},altText:{en:"p",ru:"з"},width:s,type:o,code:"KeyP",end:!1},{text:{en:"[",ru:"х"},altText:{en:"{",ru:"х"},width:s,type:r,code:"BracketLeft",end:!1},{text:{en:"]",ru:"ъ"},altText:{en:"}",ru:"ъ"},width:s,type:r,code:"BracketRight",end:!1},{text:{en:"\\",ru:"\\"},altText:{en:"|",ru:"/"},width:s,type:r,code:"Backslash",end:!1},{text:{en:"DEL",ru:"DEL"},altText:{en:"DEL",ru:"DEL"},width:i,type:d,code:"Delete",end:!0},{text:{en:"Caps Lock",ru:"Caps Lock"},altText:{en:"Caps Lock",ru:"Caps Lock"},width:i,type:d,code:"CapsLock",end:!1},{text:{en:"a",ru:"ф"},altText:{en:"a",ru:"ф"},width:s,type:o,code:"KeyA",end:!1},{text:{en:"s",ru:"ы"},altText:{en:"s",ru:"ы"},width:s,type:o,code:"KeyS",end:!1},{text:{en:"d",ru:"в"},altText:{en:"d",ru:"в"},width:s,type:o,code:"KeyD",end:!1},{text:{en:"f",ru:"а"},altText:{en:"f",ru:"а"},width:s,type:o,code:"KeyF",end:!1},{text:{en:"g",ru:"п"},altText:{en:"g",ru:"п"},width:s,type:o,code:"KeyG",end:!1},{text:{en:"h",ru:"р"},altText:{en:"h",ru:"р"},width:s,type:o,code:"KeyH",end:!1},{text:{en:"j",ru:"о"},altText:{en:"j",ru:"о"},width:s,type:o,code:"KeyJ",end:!1},{text:{en:"k",ru:"л"},altText:{en:"k",ru:"л"},width:s,type:o,code:"KeyK",end:!1},{text:{en:"l",ru:"д"},altText:{en:"l",ru:"д"},width:s,type:o,code:"KeyL",end:!1},{text:{en:";",ru:"ж"},altText:{en:":",ru:"ж"},width:s,type:r,code:"Semicolon",end:!1},{text:{en:"'",ru:"э"},altText:{en:'"',ru:"э"},width:s,type:r,code:"Quote",end:!1},{text:{en:"ENTER",ru:"ENTER"},altText:{en:"ENTER",ru:"ENTER"},width:a,type:d,code:"Enter",end:!0},{text:{en:"Shift",ru:"Shift"},altText:{en:"Shift",ru:"Shift"},width:a,type:d,code:"ShiftLeft",end:!1},{text:{en:"z",ru:"я"},altText:{en:"z",ru:"я"},width:s,type:o,code:"KeyZ",end:!1},{text:{en:"x",ru:"ч"},altText:{en:"x",ru:"ч"},width:s,type:o,code:"KeyX",end:!1},{text:{en:"c",ru:"с"},altText:{en:"c",ru:"с"},width:s,type:o,code:"KeyC",end:!1},{text:{en:"v",ru:"м"},altText:{en:"v",ru:"м"},width:s,type:o,code:"KeyV",end:!1},{text:{en:"b",ru:"и"},altText:{en:"b",ru:"и"},width:s,type:o,code:"KeyB",end:!1},{text:{en:"n",ru:"т"},altText:{en:"n",ru:"т"},width:s,type:o,code:"KeyN",end:!1},{text:{en:"m",ru:"ь"},altText:{en:"m",ru:"ь"},width:s,type:o,code:"KeyM",end:!1},{text:{en:",",ru:"б"},altText:{en:"<",ru:"б"},width:s,type:r,code:"Comma",end:!1},{text:{en:".",ru:"ю"},altText:{en:">",ru:"ю"},width:s,type:r,code:"Period",end:!1},{text:{en:"/",ru:"."},altText:{en:"?",ru:","},width:s,type:r,code:"Slash",end:!1},{text:{en:"&#8593;",ru:"&#8593;"},altText:{en:"&#8593;",ru:"&#8593;"},width:s,type:d,code:"ArrowUp",end:!1},{text:{en:"Shift",ru:"Shift"},altText:{en:"Shift",ru:"Shift"},width:a,type:d,code:"ShiftRight",end:!0},{text:{en:"Ctrl",ru:"Ctrl"},altText:{en:"Ctrl",ru:"Ctrl"},width:i,type:d,code:"ControlLeft",end:!1},{text:{en:"Win",ru:"Win"},altText:{en:"Win",ru:"Win"},width:s,type:d,code:"OSLeft",end:!1},{text:{en:"Alt",ru:"Alt"},altText:{en:"Alt",ru:"Alt"},width:i,type:d,code:"AltLeft",end:!1},{text:{en:" ",ru:" "},altText:{en:" ",ru:" "},width:"space-width",type:o,code:"Space",end:!1},{text:{en:"Alt",ru:"Alt"},altText:{en:"Alt",ru:"Alt"},width:i,type:d,code:"AltRight",end:!1},{text:{en:"&#8592;",ru:"&#8592;"},altText:{en:"&#8592;",ru:"&#8592;"},width:s,type:d,code:"ArrowLeft",end:!1},{text:{en:"&#8595;",ru:"&#8595;"},altText:{en:"&#8595;",ru:"&#8595;"},width:s,type:d,code:"ArrowDown",end:!1},{text:{en:"&#8594;",ru:"&#8594;"},altText:{en:"&#8594;",ru:"&#8594;"},width:s,type:d,code:"ArrowRight",end:!1},{text:{en:"Ctrl",ru:"Ctrl"},altText:{en:"Ctrl",ru:"Ctrl"},width:i,type:d,code:"ControlRight",end:!0}],h={backspaceKey:"Backspace",tabKey:"Tab",delKey:"DEL",capsKey:"Caps Lock",capsKeyCode:"CapsLock",enterKey:"ENTER",shiftKey:"Shift",shiftLeftKey:"ShiftLeft",shiftRightKey:"ShiftRight",ctrlKey:"Ctrl",winKey:"Win",altKey:"Alt",arrowUpKey:"&#8593;",arrowLeftKey:"&#8592;",arrowDownKey:"&#8595;",arrowRightKey:"&#8594;",arrowUp:"ArrowUp",arrowLeft:"ArrowLeft",arrowDown:"ArrowDown",arrowRight:"ArrowRight",controlLeftKey:"ControlLeft",controlRightKey:"ControlRight",alternative:"alternative",functional:"functional"};function l(e){return[h.capsKey,h.capsKeyCode].includes(e)}function u(e){return[h.shiftKey,h.shiftLeftKey,h.shiftRightKey].includes(e)}function x(e){return[h.arrowUp,h.arrowLeft,h.arrowDown,h.arrowRight].includes(e)}class y{constructor(){this.capsLock=!1,this.shift=!1,this.mouseShift=!1,this.nodeShift=null,this.keys=[],this.lang=localStorage.getItem("lang")||"en",this.textArea=document.createElement("textarea")}init(){const e=document.createElement("div");e.classList.add("wrapper");const t=document.createElement("div");t.classList.add("keyboard");const n=document.createElement("div");n.classList.add("keyboard__keys"),n.addEventListener("click",this.clickKey.bind(this));const s=document.createElement("p");s.textContent=`Смена раскладки ${h.ctrlKey} + ${h.shiftKey}`;const i=document.createElement("p");i.textContent="Сделано в Windows",this.textArea.classList.add("text"),n.append(this.createKeys()),t.append(n),e.append(this.textArea,t,s,i),document.body.append(e),function(e,...t){const n=new Set;document.addEventListener("keydown",(s=>{n.add(s.code),t.forEach((t=>{n.has(t[0])&&n.has(t[1])&&(n.clear(),e(s))}))})),document.addEventListener("keyup",(e=>{n.delete(e.code)}))}(this.switchLanguage.bind(this),[h.shiftLeftKey,h.controlLeftKey],[h.shiftRightKey,h.controlRightKey]),document.addEventListener("keydown",this.pressKey.bind(this)),document.addEventListener("keyup",this.removePressKey.bind(this))}createKeys(){const s=document.createDocumentFragment();let i=document.createElement("div");return i.classList.add("row"),c.forEach((a=>{const{text:r,width:d,altText:o,end:c,type:l,code:u}=a,x=function(s,i,a,r,d,o){let c;switch(d){case h.alternative:c=new t(s,i,a,r,o);break;case h.functional:c=new e(s,i,a,r,o);break;default:c=new n(s,i,a,r,o)}return c}(r,d,this.lang,o,l,u);x.init(),r.en===h.shiftKey&&(x.node.addEventListener("mousedown",this.shiftMouseDownHandler.bind(this)),x.node.addEventListener("mouseup",this.shiftMouseUpHandler.bind(this))),this.keys.push(x),i.append(x.node),c&&(s.append(i),i=document.createElement("div"),i.classList.add("row"))})),s}clickKey(e){if(e.target.dataset.button)switch(e.target.dataset.button){case h.backspaceKey:this.backspaceHandler();break;case h.tabKey:this.tabHandler();break;case h.delKey:this.delHandler();break;case h.capsKey:this.capsHandler(e);break;case h.enterKey:this.enterHandler();break;case h.shiftKey:this.shiftHandler(e);break;case h.arrowUpKey:this.arrowUpHandler();break;case h.ctrlKey:this.ctrlHandler();break;case h.winKey:this.winHandler();break;case h.altKey:this.altHandler();break;case h.arrowLeftKey:this.arrowLeftHandler();break;case h.arrowDownKey:this.arrowDownHandler();break;case h.arrowRightKey:this.arrowRightHandler();break;default:this.typingText(e)}}backspaceHandler(){const{value:e,selectionStart:t,selectionEnd:n}=this.textArea;t!==n?(this.textArea.value=`${e.slice(0,t)}${e.slice(n)}`,this.setCursorLocation(t)):0!==t?(this.textArea.value=`${e.slice(0,t-1)}${e.slice(t)}`,this.setCursorLocation(t-1)):this.setCursorLocation(t)}tabHandler(){const{value:e,selectionStart:t,selectionEnd:n}=this.textArea;this.textArea.value=`${e.substring(0,t)}\t${e.substring(n)}`,this.setCursorLocation(t+1)}delHandler(){const{value:e,selectionStart:t,selectionEnd:n}=this.textArea;t!==n?this.textArea.value=`${e.slice(0,t)}${e.slice(n)}`:n!==e.length&&(this.textArea.value=`${e.slice(0,t)}${e.slice(t+1)}`),this.setCursorLocation(t)}capsHandler(e){const{selectionStart:t}=this.textArea;this.capsLock=!this.capsLock,e.target.classList.toggle("active"),this.keys.forEach((e=>{e.caps()})),this.setCursorLocation(t)}enterHandler(){const{value:e,selectionStart:t,selectionEnd:n}=this.textArea;this.textArea.value=`${e.substring(0,t)}\n${e.substring(n)}`,this.setCursorLocation(t+1)}shiftHandler(e){const{selectionStart:t}=this.textArea;this.shift,this.setShiftedKeys(),e.target.classList.toggle("active"),this.setCursorLocation(t)}ctrlHandler(){const{selectionStart:e}=this.textArea;this.shift&&this.switchLanguage(),this.setCursorLocation(e)}shiftMouseDownHandler(e){!this.mouseShift&&u(e.target.textContent)&&(this.mouseShift=!0,this.nodeShift=e.target,this.shiftMouseHandler())}shiftMouseUpHandler(e){this.mouseShift&&u(e.target.textContent)&&(this.mouseShift=!1,this.shiftMouseHandler())}shiftMouseHandler(){const{selectionStart:e}=this.textArea;this.nodeShift.classList.toggle("active"),this.setShiftedKeys(),this.setCursorLocation(e)}setShiftedKeys(){this.shift=!this.shift,this.keys.forEach((e=>{e.shift()}))}winHandler(){const{selectionStart:e}=this.textArea;this.setCursorLocation(e)}altHandler(){const{selectionStart:e}=this.textArea;this.setCursorLocation(e)}arrowUpHandler(){this.setCursorLocation(0)}arrowDownHandler(){const{value:e}=this.textArea;this.setCursorLocation(e.length)}arrowLeftHandler(){const{selectionStart:e}=this.textArea;this.setCursorLocation(e-1)}arrowRightHandler(){const{selectionStart:e}=this.textArea;this.setCursorLocation(e+1)}typingText(e){const t=e.target.textContent,{value:n,selectionStart:s,selectionEnd:i}=this.textArea;this.capsLock&&this.shift?this.textArea.value=`${n.substring(0,s)}${t.toLowerCase()}${n.substring(i)}`:this.capsLock||this.shift?this.textArea.value=`${n.substring(0,s)}${t.toUpperCase()}${n.substring(i)}`:this.textArea.value=`${n.substring(0,s)}${t.toLowerCase()}${n.substring(i)}`,this.setCursorLocation(s+1)}switchLanguage(){this.lang="en"===this.lang?"ru":"en",localStorage.setItem("lang",this.lang),this.keys.forEach((e=>{e.changeLanguage(this.lang)}))}setCursorLocation(e){this.textArea.focus(),this.textArea.selectionStart=e,this.textArea.selectionEnd=e}pressKey(e){const t=this.keys.find((t=>t.code===e.code));if(t)if(x(t.code))t.node.classList.add("active");else{if(e.preventDefault(),n=t.code,s=e,(u(n)||l(n)||function(e){return[h.controlLeftKey,h.controlRightKey].includes(e)}(n))&&s.repeat)return null;l(t.code)||u(t.code)||t.node.classList.add("active"),t.node.click()}var n,s;return null}removePressKey(e){const t=this.keys.find((t=>t.code===e.code));return t&&(x(t.code)?t.node.classList.remove("active"):(e.preventDefault(),l(t.code)||u(t.code)||t.node.classList.remove("active"),u(t.code)&&t.node.click())),null}}window.onload=()=>{(new y).init()}})();